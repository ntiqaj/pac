"use client"

import {
  Table,
  TableBody,
  TableCaption,
  TableCell,
  TableHead,
  TableHeader,
  TableRow
} from "@/components/ui/table";
import { useGetWifiPerformanceBySNQuery } from '@/redux/api/station-event-by-category-api'
import { useSelector } from 'react-redux'
import { selectSnFilter, selectHoursBack } from '@/redux/features/filters'

export const WifiPerformanceTable = () => {
  const sn = useSelector(selectSnFilter)
  const hoursBack = useSelector(selectHoursBack)

  const { data } = useGetWifiPerformanceBySNQuery(
    { sn: sn || '', hoursBack: hoursBack || 24 },
    { skip: !sn }
  )

  return (
    <Table className="wifi-performance-table">
      <TableHeader>
        
        <TableRow>
          <TableHead className="w-[100px]">Status</TableHead>
          <TableHead>Client & Vendor Name</TableHead>
          <TableHead>Last Updated Time</TableHead>
          <TableHead>Connected Time</TableHead>
          <TableHead>Data Usage</TableHead>
          <TableHead>Band Usage</TableHead>
          <TableHead>Signal Strength</TableHead>
          <TableHead>Avg Signal (24 hrs)</TableHead>
          <TableHead>Link Rate (Mbps)</TableHead>
          <TableHead>IP Address</TableHead>
          <TableHead>Channel No</TableHead>
          <TableHead className="text-right">Retransmission</TableHead>
        </TableRow>
      </TableHeader>
      <TableBody>
        {data?.data.map((item, index) => (
          <TableRow key={index}>
            <TableCell>{item.stations_status ? '●' : '○'}</TableCell>
            <TableCell>{item.station_name}</TableCell>
            <TableCell>{item.station_last_report}</TableCell>
            <TableCell>{item.connected_time}</TableCell>
            <TableCell>{item.ldur}</TableCell>
            <TableCell>{item.bs}</TableCell>
            <TableCell>{`${item.signal_strength} (${item.signal_strength > -70 ? 'Good' : 'Poor'})`}</TableCell>
            <TableCell>{item.snr}</TableCell>
            <TableCell>{item.link_rate}</TableCell>
            <TableCell>{item.station_ip}</TableCell>
            <TableCell>{item.channel}</TableCell>
            <TableCell className="text-right">{item.rtc}</TableCell>
          </TableRow>
        ))}
      </TableBody>
    </Table>
  )}
